(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[6437],{1137:function(e,s,l){(window.__NEXT_P=window.__NEXT_P||[]).push(["/[locale]/dashboard/queue",function(){return l(917)}])},3101:function(e,s,l){"use strict";l.d(s,{i:function(){return i}});var t=l(5893);l(7294);let i=()=>(0,t.jsx)("div",{className:"relative p-4 sm:p-6 lg:p-8",children:(0,t.jsx)("div",{className:"absolute inset-0 flex items-center","aria-hidden":"true",children:(0,t.jsx)("div",{className:"w-full border-t border-gray-300"})})})},917:function(e,s,l){"use strict";l.r(s),l.d(s,{__N_SSG:function(){return w},default:function(){return q}});var t=l(5893),i=l(9008),a=l.n(i),d=l(5423),n=l(7765),o=l(5558),r=l(7294),u=l(6542),c=l(3101),m=l(1163),x=l(6154),v=l(9906);async function h(e){try{let s=await (0,x.Z)({method:"delete",url:"".concat("https://api.kalygo.io","/api/v1/remove-job-from-queue"),headers:{"Content-Type":"application/json"},data:{jobId:e},withCredentials:!0});return s}catch(e){console.error(e),(0,v.Jc)("Error occurred when viewing summary queue")}}let g=e=>{var s,l,i,a;let{t:d}=(0,o.$G)(),{job:n,router:r,triggerFetch:u,fetchCounter:c}=e;return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)("div",{children:(0,t.jsxs)("dl",{children:[(0,t.jsxs)("div",{className:"px-4 py-2 sm:grid sm:grid-cols-3 sm:gap-4 sm:px-0",children:[(0,t.jsx)("dt",{className:"text-sm font-medium leading-6 text-gray-900",children:d("dashboard-page:queue.job-type")}),(0,t.jsx)("dd",{className:"mt-1 text-sm leading-6 text-gray-700 sm:col-span-2 sm:mt-0",children:null==n?void 0:null===(s=n.data)||void 0===s?void 0:s.jobType})]}),(0,t.jsxs)("div",{className:"px-4 py-2 sm:grid sm:grid-cols-3 sm:gap-4 sm:px-0",children:[(0,t.jsx)("dt",{className:"text-sm font-medium leading-6 text-gray-900",children:d("dashboard-page:queue.file-name")}),(0,t.jsx)("dd",{className:"mt-1 text-sm leading-6 text-gray-700 sm:col-span-2 sm:mt-0",children:null==n?void 0:null===(l=n.data)||void 0===l?void 0:null===(i=l.params)||void 0===i?void 0:i.originalName})]}),(0,t.jsxs)("div",{className:"px-4 py-2 sm:grid sm:grid-cols-3 sm:gap-4 sm:px-0",children:[(0,t.jsx)("dt",{className:"text-sm font-medium leading-6 text-gray-900",children:d("dashboard-page:queue.requested-at")}),(0,t.jsx)("dd",{className:"mt-1 text-sm leading-6 text-gray-700 sm:col-span-2 sm:mt-0",children:"".concat(new Date(null==n?void 0:n.processedOn))})]})]})}),(0,t.jsxs)("span",{className:"mt-2 isolate inline-flex rounded-md",children:[(null==n?void 0:n.finishedOn)&&(0,t.jsx)("button",{type:"button",className:"mx-0.5 inline-flex items-center gap-x-2 rounded-md bg-red-600 px-3 py-2 text-sm font-semibold text-white shadow-sm hover:bg-red-500 focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-red-600",onClick:()=>{h(null==n?void 0:n.id),u(c+1)},children:d("dashboard-page:queue.remove")}),(null==n?void 0:n.progress)===100&&(null==n?void 0:null===(a=n.returnvalue)||void 0===a?void 0:a.summaryId)&&(0,t.jsx)("button",{type:"button",className:"mx-0.5 inline-flex items-center gap-x-2 rounded-md bg-blue-600 px-3 py-2 text-sm font-semibold text-white shadow-sm hover:bg-blue-500 focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-blue-600",onClick:()=>{var e;r.push("/dashboard/summary?summary-id=".concat(null==n?void 0:null===(e=n.returnvalue)||void 0===e?void 0:e.summaryId))},children:d("dashboard-page:queue.view")})]})]})},p=e=>{var s,l,i,a;let{t:d}=(0,o.$G)(),{job:n,router:r,triggerFetch:u,fetchCounter:c}=e;return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)("div",{children:(0,t.jsxs)("dl",{children:[(0,t.jsxs)("div",{className:"px-4 py-2 sm:grid sm:grid-cols-3 sm:gap-4 sm:px-0",children:[(0,t.jsx)("dt",{className:"text-sm font-medium leading-6 text-gray-900",children:d("dashboard-page:queue.job-type")}),(0,t.jsx)("dd",{className:"mt-1 text-sm leading-6 text-gray-700 sm:col-span-2 sm:mt-0",children:null==n?void 0:null===(s=n.data)||void 0===s?void 0:s.jobType})]}),(0,t.jsxs)("div",{className:"px-4 py-2 sm:grid sm:grid-cols-3 sm:gap-4 sm:px-0",children:[(0,t.jsx)("dt",{className:"text-sm font-medium leading-6 text-gray-900",children:d("dashboard-page:queue.file-names")}),(0,t.jsx)("dd",{className:"mt-1 text-sm leading-6 text-gray-700 sm:col-span-2 sm:mt-0",children:(0,t.jsx)("ul",{children:null==n?void 0:null===(l=n.data)||void 0===l?void 0:null===(i=l.params)||void 0===i?void 0:i.files.map(e=>(0,t.jsx)("li",{children:e.originalname},e.originalname))})})]}),(0,t.jsxs)("div",{className:"px-4 py-2 sm:grid sm:grid-cols-3 sm:gap-4 sm:px-0",children:[(0,t.jsx)("dt",{className:"text-sm font-medium leading-6 text-gray-900",children:d("dashboard-page:queue.requested-at")}),(0,t.jsx)("dd",{className:"mt-1 text-sm leading-6 text-gray-700 sm:col-span-2 sm:mt-0",children:"".concat(new Date(null==n?void 0:n.processedOn))})]})]})}),(0,t.jsxs)("span",{className:"mt-2 isolate inline-flex rounded-md",children:[(null==n?void 0:n.finishedOn)&&(0,t.jsx)("button",{type:"button",className:"mx-0.5 inline-flex items-center gap-x-2 rounded-md bg-red-600 px-3 py-2 text-sm font-semibold text-white shadow-sm hover:bg-red-500 focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-red-600",onClick:()=>{h(null==n?void 0:n.id),u(c+1)},children:d("dashboard-page:queue.remove")}),(null==n?void 0:n.progress)===100&&(null==n?void 0:null===(a=n.returnvalue)||void 0===a?void 0:a.customRequestId)&&(0,t.jsx)("button",{type:"button",className:"mx-0.5 inline-flex items-center gap-x-2 rounded-md bg-blue-600 px-3 py-2 text-sm font-semibold text-white shadow-sm hover:bg-blue-500 focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-blue-600",onClick:()=>{var e;r.push("/dashboard/custom-request-result?custom-request-id=".concat(null==n?void 0:null===(e=n.returnvalue)||void 0===e?void 0:e.customRequestId))},children:d("dashboard-page:queue.view")})]})]})},b=e=>{var s,l,i,a;let{t:d}=(0,o.$G)(),{job:n,router:r,triggerFetch:u,fetchCounter:c}=e;return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)("div",{children:(0,t.jsxs)("dl",{children:[(0,t.jsxs)("div",{className:"px-4 py-2 sm:grid sm:grid-cols-3 sm:gap-4 sm:px-0",children:[(0,t.jsx)("dt",{className:"text-sm font-medium leading-6 text-gray-900",children:d("dashboard-page:queue.job-type")}),(0,t.jsx)("dd",{className:"mt-1 text-sm leading-6 text-gray-700 sm:col-span-2 sm:mt-0",children:null==n?void 0:null===(s=n.data)||void 0===s?void 0:s.jobType})]}),(0,t.jsxs)("div",{className:"px-4 py-2 sm:grid sm:grid-cols-3 sm:gap-4 sm:px-0",children:[(0,t.jsx)("dt",{className:"text-sm font-medium leading-6 text-gray-900",children:d("dashboard-page:queue.vector-search.query")}),(0,t.jsx)("dd",{className:"mt-1 text-sm leading-6 text-gray-700 sm:col-span-2 sm:mt-0",children:(0,t.jsx)("code",{children:null==n?void 0:null===(l=n.data)||void 0===l?void 0:null===(i=l.params)||void 0===i?void 0:i.query})})]}),(0,t.jsxs)("div",{className:"px-4 py-2 sm:grid sm:grid-cols-3 sm:gap-4 sm:px-0",children:[(0,t.jsx)("dt",{className:"text-sm font-medium leading-6 text-gray-900",children:d("dashboard-page:queue.requested-at")}),(0,t.jsx)("dd",{className:"mt-1 text-sm leading-6 text-gray-700 sm:col-span-2 sm:mt-0",children:"".concat(new Date(null==n?void 0:n.processedOn))})]})]})}),(0,t.jsxs)("span",{className:"mt-2 isolate inline-flex rounded-md",children:[(null==n?void 0:n.finishedOn)&&(0,t.jsx)("button",{type:"button",className:"mx-0.5 inline-flex items-center gap-x-2 rounded-md bg-red-600 px-3 py-2 text-sm font-semibold text-white shadow-sm hover:bg-red-500 focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-red-600",onClick:()=>{h(null==n?void 0:n.id),u(c+1)},children:d("dashboard-page:queue.remove")}),(null==n?void 0:n.progress)===100&&(null==n?void 0:null===(a=n.returnvalue)||void 0===a?void 0:a.vectorSearchId)&&(0,t.jsx)("button",{type:"button",className:"mx-0.5 inline-flex items-center gap-x-2 rounded-md bg-blue-600 px-3 py-2 text-sm font-semibold text-white shadow-sm hover:bg-blue-500 focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-blue-600",onClick:()=>{var e;r.push("/dashboard/vector-search-result?vector-search-id=".concat(null==n?void 0:null===(e=n.returnvalue)||void 0===e?void 0:e.vectorSearchId))},children:d("dashboard-page:queue.view")})]})]})},f=e=>{let{jobs:s,fetchCounter:l,triggerFetch:i}=e,{t:a}=(0,o.$G)(),[d,n]=(0,r.useState)(0),u=(0,m.useRouter)();return console.log("jobs",s),(0,t.jsxs)("div",{className:"relative mx-4 sm:mx-6 lg:mx-8",children:[0===s.length&&a("dashboard-page:queue.nothing-found"),s.map((e,s)=>{var d,n;console.log("i",null==e?void 0:null===(d=e.data)||void 0===d?void 0:d.jobType);let o=null;switch(null==e?void 0:null===(n=e.data)||void 0===n?void 0:n.jobType){case"Summary":o=(0,t.jsx)(g,{job:e,router:u,triggerFetch:i,fetchCounter:l});break;case"VectorSearch":o=(0,t.jsx)(b,{job:e,router:u,triggerFetch:i,fetchCounter:l});break;case"CustomRequest":o=(0,t.jsx)(p,{job:e,router:u,triggerFetch:i,fetchCounter:l})}return(0,t.jsxs)("div",{children:[(0,t.jsx)(c.i,{}),(0,t.jsx)("h4",{className:"sr-only",children:a("dashboard-page:queue.job-status")}),o,(0,t.jsx)("div",{className:"mt-6","aria-hidden":"true",children:(0,t.jsx)("div",{className:"overflow-hidden rounded-full bg-gray-200",children:(null==e?void 0:e.failedReason)?(0,t.jsx)("div",{className:"h-1 rounded-full bg-red-600",style:{width:"100%"}}):(0,t.jsx)("div",{className:"h-1 rounded-full bg-blue-600",style:{width:"".concat(null==e?void 0:e.progress,"%")}})})})]},s)})]})};async function j(){try{let e=await (0,x.Z)({method:"get",url:"".concat("https://api.kalygo.io","/api/v1/view-queue"),headers:{"Content-Type":"application/json"},onUploadProgress:e=>{console.log("onUploadProgress",e)},withCredentials:!0});return e}catch(e){console.error(e),(0,v.Jc)("Error occurred when viewing queue")}}var y=l(9208),N=l.n(y),w=!0;function q(){var e;let{state:s,dispatch:l}=(0,d.b)(),{t:i}=(0,o.$G)(),[c,m]=(0,r.useState)(0),[x,v]=(0,r.useState)({val:[],loading:!0,err:null});(0,r.useEffect)(()=>{let e=setInterval(async()=>{try{let e=await j(),s=N()(e,"data.activeJobs",[]);v({val:s,loading:!1,err:null})}catch(e){v({val:x.val,loading:!1,err:e})}},5e3);return()=>clearInterval(e)},[]),(0,r.useEffect)(()=>{console.log("useEffect viewQueue"),async function(){try{let e=await j(),s=N()(e,"data.activeJobs",[]);v({val:s,loading:!1,err:null})}catch(e){v({val:x.val,loading:!1,err:e})}}()},[c]);let h=null;return h=x.loading?(0,t.jsx)(u.z,{}):x.err?(0,t.jsx)(t.Fragment,{children:"Error loading summaries"}):x.val?(0,t.jsx)(f,{fetchCounter:c,triggerFetch:m,jobs:x.val}):(0,t.jsx)(t.Fragment,{children:"Unknown error"}),(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(a(),{children:(0,t.jsx)("title",{children:i("seo:dashboard-page-seo-meta-title")})}),(0,t.jsx)(n.Z,{children:(0,t.jsxs)("div",{className:"p-4 sm:p-6 lg:p-8",children:[(0,t.jsxs)("div",{className:"sm:flex sm:items-center",children:[(0,t.jsx)("div",{className:"sm:flex-auto",children:(0,t.jsx)("h2",{className:"text-2xl font-bold leading-7 text-gray-900 sm:truncate sm:text-3xl sm:tracking-tight",children:i("dashboard-page:queue.title")})}),(0,t.jsx)("span",{children:(null===(e=x.val)||void 0===e||e.length,"")})]}),(0,t.jsx)("div",{className:"mt-8 flow-root",children:(0,t.jsx)("div",{className:"-mx-4 -my-2 overflow-x-auto sm:-mx-6 lg:-mx-8",children:(0,t.jsx)("div",{className:"inline-block min-w-full py-2 align-middle sm:px-6 lg:px-8",children:h})})})]})})]})}q.requireAuth=!0},9906:function(e,s,l){"use strict";l.d(s,{Jc:function(){return t.J},Rr:function(){return i.R}});var t=l(6133),i=l(8928);l(5678)}},function(e){e.O(0,[5675,1664,5912,4165,820,9208,7765,9774,2888,179],function(){return e(e.s=1137)}),_N_E=e.O()}]);